# Prompt Template: 業務邏輯審計

## 使用時機
- 分析複雜的業務邏輯函數
- 檢查狀態轉換是否正確
- 驗證數學計算邏輯

---

## Template 1: 通用業務邏輯

```markdown
## 協議背景
[簡述協議類型和核心機制]

## 函數用途
這個函數 `[函數名]` 的作用是：
[描述函數應該做什麼]

## 核心不變量
這個函數必須維持以下條件：
1. [不變量 1]
2. [不變量 2]

## 程式碼
```solidity
[貼上函數程式碼]
```

## 請分析
1. 這個函數是否正確實現了描述的功能？
2. 是否可能違反列出的不變量？
3. 有沒有邊界條件沒有處理？
4. 用具體數字舉例說明執行結果
```

---

## Template 2: 分配/權重計算

```markdown
## 場景
需要將 [資源類型] 分配給 [N] 個接收者

## 預期行為
- 總資源 = X
- 每個接收者應該得到比例份額
- 所有份額總和 = 100%（或 = 總資源）

## 程式碼
```solidity
[貼上程式碼]
```

## 驗證問題
假設：
- 總資源 = 1000
- 接收者數量 = 3

1. 每個接收者會得到多少？
2. 三者總和是多少？
3. 這個總和正確嗎？
4. 如果接收者數量變成 10，結果會如何？
```

---

## Template 3: 條件分支邏輯

```markdown
## 業務規則
- 當 [條件 A] 時，應該執行 [動作 X]
- 當 [條件 B] 時，應該執行 [動作 Y]

## 程式碼
```solidity
[貼上程式碼]
```

## 檢查項目
1. 程式碼中的條件判斷是什麼？
2. 在該條件下執行了什麼動作？
3. 條件和動作的對應關係正確嗎？
4. 比較運算符（<, >, <=, >=）是否正確？
5. 有沒有遺漏的條件分支？
```

---

## Template 4: 狀態轉換

```markdown
## 狀態機描述
```
[State A] --event1--> [State B]
[State B] --event2--> [State C]
[State B] --event3--> [State A]
```

## 函數作用
這個函數處理從 [State X] 到 [State Y] 的轉換

## 程式碼
```solidity
[貼上程式碼]
```

## 驗證
1. 函數是否檢查了當前狀態？
2. 轉換後的狀態是否正確設置？
3. 是否有非法的狀態轉換路徑？
4. 狀態轉換是否可以被重入攻擊？
```

---

## Template 5: 數學計算審計

```markdown
## 計算目的
計算 [什麼值]，用於 [什麼目的]

## 預期公式
[數學公式或 pseudocode]

## 程式碼
```solidity
[貼上程式碼]
```

## 檢查
1. 實現是否匹配預期公式？
2. 除法是否可能除以零？
3. 乘法是否可能 overflow？
4. 精度損失是否在可接受範圍？
5. 負數處理是否正確？
```

---

## 使用技巧

1. **先給 context，再問問題**
   - AI 需要知道「這個函數應該做什麼」才能判斷對錯

2. **用具體數字**
   - 「假設 X=1000, N=3」比「假設有多個」更有效

3. **列出不變量**
   - 明確告訴 AI 什麼條件必須維持

4. **一次一個函數**
   - 不要一次貼太多程式碼

5. **追問 follow-up**
   - 「如果 N=0 呢？」
   - 「如果中間有人 withdraw 呢？」
