# Token Findings (Solodit)

> Token handling issues with non-standard ERC20 implementations

## Overview

| ID | Severity | Title | Platform |
|----|----------|-------|----------|
| SOL-013 | 游 high | Fee-on-Transfer Token Not Handled | Code4rena |
| SOL-014 | 游리 medium | USDT Approval Race Condition | Sherlock |
| SOL-034 | 游 high | Rebasing Token Balance Mismatch | Code4rena |
| SOL-035 | 游리 medium | Pausable Token Blocks Liquidations | Sherlock |
| SOL-036 | 游 high | ERC777 Callback Reentrancy in Deposit | Code4rena |
| SOL-068 | 游 high | Blocklist Token Transfer Reverts | Sherlock |
| SOL-069 | 游리 medium | Token With Multiple Addresses | Code4rena |

---

## SOL-013: Fee-on-Transfer Token Not Handled

**Severity:** 游 HIGH  
**Platform:** Code4rena  
**Protocol Type:** DEX Protocol

### Description
Protocol assumes transferFrom transfers exact amount, but fee-on-transfer tokens transfer less.

### Impact
Protocol accounting becomes incorrect, potentially draining funds.

### Vulnerable Code
```solidity
IERC20(token).transferFrom(user, address(this), amount);
balances[user] += amount;  // Actual received < amount
```

### Fix
```solidity
uint256 before = IERC20(token).balanceOf(address(this));
IERC20(token).transferFrom(user, address(this), amount);
uint256 received = IERC20(token).balanceOf(address(this)) - before;
balances[user] += received;
```

---

## SOL-014: USDT Approval Race Condition

**Severity:** 游리 MEDIUM  
**Platform:** Sherlock  
**Protocol Type:** DeFi Protocol

### Description
USDT requires approval to be set to 0 before changing to non-zero value.

### Impact
Transactions revert when trying to change approval.

### Vulnerable Code
```solidity
IERC20(usdt).approve(spender, newAmount);  // Reverts if current != 0
```

### Fix
```solidity
IERC20(usdt).approve(spender, 0);
IERC20(usdt).approve(spender, newAmount);
```

---

## SOL-034: Rebasing Token Balance Mismatch

**Severity:** 游 HIGH  
**Platform:** Code4rena  
**Protocol Type:** Vault Protocol

### Description
Protocol caches rebasing token balance, but actual balance changes.

### Impact
Accounting mismatch leads to stuck funds or extra withdrawals.

### Vulnerable Code
```solidity
mapping(address => uint256) public deposits;
function deposit(uint256 amount) external {
    token.transferFrom(msg.sender, address(this), amount);
    deposits[msg.sender] += amount;  // Cached, not actual
}
```

### Fix
```solidity
// Track shares instead of amounts for rebasing tokens
// Or use wrapper that handles rebasing
```

---

## SOL-035: Pausable Token Blocks Liquidations

**Severity:** 游리 MEDIUM  
**Platform:** Sherlock  
**Protocol Type:** Lending Protocol

### Description
Token transfer pause prevents liquidations, accumulating bad debt.

### Impact
Protocol accrues bad debt during pause period.

### Vulnerable Code
```solidity
function liquidate(address user) external {
    // If token is paused, this reverts
    collateralToken.transfer(liquidator, collateral);
}
```

### Fix
```solidity
// Whitelist liquidation function from pause
// Or use pull-pattern for liquidations
```

---

## SOL-036: ERC777 Callback Reentrancy in Deposit

**Severity:** 游 HIGH  
**Platform:** Code4rena  
**Protocol Type:** Staking Protocol

### Description
ERC777 tokensReceived callback triggers before deposit state update.

### Impact
Attacker can deposit same tokens multiple times.

### Vulnerable Code
```solidity
function deposit(uint256 amount) external {
    token.transferFrom(msg.sender, address(this), amount);  // Callback here
    balances[msg.sender] += amount;
}
```

### Fix
```solidity
function deposit(uint256 amount) external nonReentrant {
    balances[msg.sender] += amount;  // State first
    token.transferFrom(msg.sender, address(this), amount);
}
```

---

## SOL-068: Blocklist Token Transfer Reverts

**Severity:** 游 HIGH  
**Platform:** Sherlock  
**Protocol Type:** DeFi Protocol

### Description
Transfer to blocklisted address reverts entire operation.

### Impact
Blocked user can grief all distributions.

### Vulnerable Code
```solidity
function distribute(address[] calldata users) external {
    for (uint i = 0; i < users.length; i++) {
        usdc.transfer(users[i], amounts[i]);  // Reverts if any blocklisted
    }
}
```

### Fix
```solidity
// Skip failed transfers or use pull pattern
```

---

## SOL-069: Token With Multiple Addresses

**Severity:** 游리 MEDIUM  
**Platform:** Code4rena  
**Protocol Type:** DEX Protocol

### Description
Same token accessible via multiple addresses (e.g., proxy + implementation).

### Impact
Attacker creates duplicate pools, extracts arbitrage.

### Vulnerable Code
```solidity
// Two pools for same underlying token
// Attacker arbitrages between them
```

### Fix
```solidity
// Canonicalize token addresses
// Block proxy addresses
```

---


*Imported from Solodit curated findings*
