# Flash Loan Findings (Solodit)

> Flash loan attack vectors and protections

## Overview

| ID | Severity | Title | Platform |
|----|----------|-------|----------|
| SOL-009 | ðŸ”´ critical | Flash Loan Governance Attack | Sherlock |
| SOL-010 | ðŸŸ  high | ERC4626 Vault Inflation Attack | Code4rena |
| SOL-029 | ðŸ”´ critical | Oracle Spot Price Manipulation via Flash Loan | Immunefi |
| SOL-030 | ðŸŸ  high | VeToken Voting Power via Flash Loan | Code4rena |
| SOL-059 | ðŸŸ  high | Just-in-Time Liquidity Attack | Code4rena |
| SOL-073 | ðŸŸ  high | Read-Only Reentrancy via Balancer Vault | Sherlock |

---

## SOL-009: Flash Loan Governance Attack

**Severity:** ðŸ”´ CRITICAL  
**Platform:** Sherlock  
**Protocol Type:** DAO Protocol

### Description
Governance voting uses current token balance without snapshot, allowing flash loan voting.

### Impact
Attacker can pass any proposal with flash-borrowed tokens.

### Vulnerable Code
```solidity
function vote(uint256 proposalId, bool support) external {
    uint256 weight = token.balanceOf(msg.sender);  // Current balance!
    proposals[proposalId].votes += weight;
}
```

### Fix
```solidity
function vote(uint256 proposalId, bool support) external {
    uint256 weight = token.getPastVotes(msg.sender, proposals[proposalId].snapshotBlock);
    proposals[proposalId].votes += weight;
}
```

---

## SOL-010: ERC4626 Vault Inflation Attack

**Severity:** ðŸŸ  HIGH  
**Platform:** Code4rena  
**Protocol Type:** Vault Protocol

### Description
First depositor can inflate share price by donating tokens, causing subsequent depositors to receive 0 shares.

### Impact
First depositor steals funds from all subsequent depositors.

### Vulnerable Code
```solidity
// Attacker deposits 1 wei, then donates 1e18 tokens
// sharePrice = 1e18 / 1 = 1e18
// Victim deposits 0.5e18, receives 0 shares (rounds down)
```

### Fix
```solidity
// Use virtual offset
function _convertToShares(uint256 assets) internal view returns (uint256) {
    return assets.mulDiv(totalSupply() + 1e3, totalAssets() + 1, Math.Rounding.Down);
}
```

---

## SOL-029: Oracle Spot Price Manipulation via Flash Loan

**Severity:** ðŸ”´ CRITICAL  
**Platform:** Immunefi  
**Protocol Type:** Lending Protocol

### Description
Protocol uses AMM spot price as oracle, manipulable within single transaction.

### Impact
Attacker borrows at manipulated price, extracts protocol funds.

### Vulnerable Code
```solidity
function getPrice() external view returns (uint256) {
    (uint112 r0, uint112 r1,) = pair.getReserves();
    return r1 * 1e18 / r0;  // Spot price!
}
```

### Fix
```solidity
// Use Chainlink or TWAP with sufficient period
function getPrice() external view returns (uint256) {
    return chainlink.latestAnswer();
}
```

---

## SOL-030: VeToken Voting Power via Flash Loan

**Severity:** ðŸŸ  HIGH  
**Platform:** Code4rena  
**Protocol Type:** ve Governance

### Description
veToken checkpoint allows immediate voting power increase from deposits.

### Impact
Flash loan tokens, gain voting power, pass proposal, return tokens.

### Vulnerable Code
```solidity
function checkpoint() external {
    // Voting power based on current balance
    votingPower[msg.sender] = token.balanceOf(msg.sender);
}
```

### Fix
```solidity
// Use time-weighted voting power
// Or snapshot at proposal creation block
```

---

## SOL-059: Just-in-Time Liquidity Attack

**Severity:** ðŸŸ  HIGH  
**Platform:** Code4rena  
**Protocol Type:** AMM Protocol

### Description
Attacker adds liquidity just before large trade, removes after.

### Impact
MEV extraction from traders via JIT attack.

### Vulnerable Code
```solidity
// No time-weighted fee distribution
// Immediate fee accrual enables JIT
```

### Fix
```solidity
// Implement fee delay or time-weighted distribution
```

---

## SOL-073: Read-Only Reentrancy via Balancer Vault

**Severity:** ðŸŸ  HIGH  
**Platform:** Sherlock  
**Protocol Type:** Lending Protocol

### Description
Protocol reads pool state during Balancer callback when invariants broken.

### Impact
Manipulated collateral values enable bad debt.

### Vulnerable Code
```solidity
// During Balancer swap callback:
uint256 value = balancerPool.getRate() * balance;  // Rate is wrong!
```

### Fix
```solidity
// Check Balancer vault reentrancy lock
// Or use external oracle
```

---


*Imported from Solodit curated findings*
